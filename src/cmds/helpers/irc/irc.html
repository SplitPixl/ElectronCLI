<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
	   <title>ElectronCLI IRC</title>
    <link rel="stylesheet" type="text/css" href="../../../theme.css">
	<script>
    var os = require('os')
    var ircClient = require('node-irc');
    var iprompt = '> '
    var myName = 'Pixld'
	</script>
  </head>
  <body>
    <div class="titlebar">
        <div style="display:flex;justify-content:flex-end;align-items:center;">
          <div style="margin-right: 10px; -webkit-app-region: no-drag;"><strong><a onclick="" class="titleFunc">_</a>   <a onclick="" class="titleFunc">â–¡</a>   <a onclick="window.close()" class="titleFunc">X</a></strong></div>
        </div>
    </div>
    <br><br>
    <div id="buffer">
      Welcome to the IRC client.<br>
      What will people call you?
    </div>
    <br>
    <span><script>document.write(iprompt)</script><input id="inputMain" class="inputMain" onkeydown="if (event.keyCode == 13) { run(); return false; }" autofocus><!--<span class="blinker">_</span>--></span>
    </body>

    <script>
     var connected = false
     var client = new ircClient('irc.freenode.net', 6667, myName, myName);

     client.on('ready', function () {
         connected = true
         client.join('#electroncli');
         appendIRCBuffer("Connected!")
         appendIRCBuffer("------------")
     });

     client.on('CHANMSG', function (data) {
      var message = data.sender + ' > ' + data.message;
      appendIRCBuffer(message.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/"/g, '&quot;'))
      document.getElementById('inputMain').scrollIntoView();
    });

     function run() {
       var input = document.getElementById("inputMain").value.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/"/g, '&quot;');
       var rinput = document.getElementById("inputMain").value
       if(connected){
          if(rinput != ""){
            client.say('#electroncli', rinput);
            appendIRCBuffer(myName + " > " + input)
            document.getElementById('inputMain').scrollIntoView();
            document.getElementById("inputMain").value = ""
          }
        } else {
          myName = input
          appendIRCBuffer(iprompt + input)
          client.connect()
          appendIRCBuffer("<br>Connecting...")
          document.getElementById('inputMain').scrollIntoView();
          document.getElementById("inputMain").value = ""
        }
     }

     function appendIRCBuffer(output) {
       var buffer = document.getElementById("buffer").innerHTML
       document.getElementById("buffer").innerHTML = buffer + "<br><span>" + output + "</span>\n"
     }

     </script>
</html>
